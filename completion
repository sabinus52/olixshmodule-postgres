
###
# Fonction principale
##
_olixsh_module()
{
    local CUR PREV PREV2
    COMPREPLY=()
    PREV="${COMP_WORDS[COMP_CWORD-1]}"
    PREV2="${COMP_WORDS[COMP_CWORD-2]}"

    case "${PREV}" in
        postgres)
            _olixsh_module_actions
            return 0
            ;;
        init)
            _olixsh_module_init
            return 0
            ;;
        dump|sync)
            _olixsh_module_dump
            return 0
            ;;
        restore)
            _olixsh_module_restore
            return 0
            ;;
    esac
}


###
# Liste des actions du module postgres
##
_olixsh_module_actions()
{
    local CUR ACTIONS
    CUR="${COMP_WORDS[COMP_CWORD]}"
    ACTIONS="init check create dump restore sync backup bckwal help"

    COMPREPLY=( $(compgen -W "${ACTIONS}" -- ${CUR}) )
}


###
# Liste des packages de l'action INIT du module postgres
##
_olixsh_module_init()
{
    local CUR PACKAGES
    CUR="${COMP_WORDS[COMP_CWORD]}"

    COMPREPLY=( $(compgen -W "--force" -- ${CUR}) )
}


###
# Liste des packages de l'action DUMP du module postgres
##
_olixsh_module_dump()
{
    local CUR BASES
    CUR="${COMP_WORDS[COMP_CWORD]}"

    COMPREPLY=( $(compgen -W "$(${OLIX_ROOT_COMP}/olixsh postgres --list)" -- ${CUR}) )
}


###
# Liste des packages de l'action RESTORE du module postgres
##
_olixsh_module_restore()
{
    local CUR BASES
    CUR="${COMP_WORDS[COMP_CWORD]}"

    COMPREPLY=( $(compgen -f -- ${CUR}) )
}
